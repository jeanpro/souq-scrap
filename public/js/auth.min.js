function signOut(){Cookies.remove("uid"),firebase.auth().signOut().then(function(){window.location.pathname="/"},function(a){var e=a.message;console.log(a),alertModal("danger",e),hideLoading()})}function validateURL(a){return a.indexOf("uae.souq.com")!=-1||"Please check if the link is the one from souq: 'http://uae.souq.com...'"}function progressBarAnimate(a,e){var r="";r+='<div class="progress">',r+='  <div class="progress-bar progress-bar-info" role="progressbar" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100" style="width: 0%">',r+="  </div>",r+="</div>",$(a).prepend(r);var o=$(a+" .progress").width();$(a+" .progress").parent().prepend("<div class='prepend'>Please wait...</div>");var d=$(a+" .progress-bar"),t=o/15,n=setInterval(function(){d.width()<o?d.width(d.width()+t):$(a+" .progress-bar").addClass("progress-bar-striped active")},300+Math.floor(100*Math.random()+1));return n}function timestamp2dateObj(a){var e=a.slice(0,-2).split("/"),r=new Date(parseInt(e[2]),parseInt(e[1])-1,parseInt(e[0])),o={day:parseInt(e[0]),month:parseInt(e[1]),year:parseInt(e[2]),hour:parseInt(a.slice(-2).replace("_","")),date:r,weekDay:weekDay(r.getDay())};return o}function generateGraph(a,e,r){return new Promise(function(e,o){var d=$(r).find(".ct-chart");$(d).html("");var t=$(d).attr("id");$.ajax({method:"POST",url:"/logs",data:{pid:a},success:function(a){if(a.success){var r=[],o=[],d=[];a.stamps.forEach(function(a,e){var t=timestamp2dateObj(a.timestamp);d.forEach(function(e){e.day==t.day&&e.month==t.month&&e.year==t.year||(o.push(a.price),r.push(t.day+"/"+t.month+"<br>("+a.price+")"),d.push({day:t.day,month:t.month,year:t.year}))})});var n=new Chartist.Line("#"+t,{labels:r,series:[o]},{low:0,showArea:!0});e(n)}else console.log(a.error),e(!1)},error:function(a){console.log(a),e(!1)}})})}function weekDay(a){if(a>=7)return!1;var e=[],r="none"===$("#isSmartphone").css("display")?"sm":"md";switch(r){case"lg":e=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];break;case"md":e=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];break;case"sm":e=["S","M","T","W","T","F","S"];break;default:e=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]}return a===-1?e:void 0}$(document).ready(function(){$(".addonModal").on("shown.bs.modal",function(){$("#links-collapse").collapse("hide")});var a="";a+='<i><p>No products to show. <a href="#" data-toggle="modal" data-target="#addModal">Click here</a> and start monitoring prices on <a target="_blank" href="http://www.souq.com/" >Souq.com</a></p></i>';var e=Cookies.get("uid");$.ajax({method:"GET",url:"/track",data:{uid:e},success:function(e){e.success?($("#products").html(e.html),$(".graph-open").on("click",function(a){var e=$(this).data("id"),r=timestamp2dateObj($(this).data("original")),o=generateGraph(e,r,"#graphModal");o.then(function(a){a.on("draw",function(a){"line"!==a.type&&"area"!==a.type||a.element.animate({d:{begin:2e3*a.index,dur:2e3,from:a.path.clone().scale(1,0).translate(0,a.chartRect.height()).stringify(),to:a.path.clone().stringify(),easing:Chartist.Svg.Easing.easeOutQuint}})}),a.update()}).catch(function(a){setTimeout(function(){$("#graphModal").modal("hide"),alertModal("danger","Could not open graph.","Error!")},200)})})):$("#products").html(a)},error:function(a){console.log(a),alertModal("alert-danger","Error during request...","Error")}}),$("#addTrack").on("click",function(a){a.preventDefault();var e=JSON.parse(JSON.stringify($("#addproduct").val())),r=validateURL(e);if(e)if(1!=r)alertSend(r,"#addModal .modal-body","danger","Invalid URL!"),$("#addproduct").closest(".form-group").addClass("has-error");else{progressBarAnimate("#addModal .modal-body",10);loading();var o=setTimeout(function(){hideLoading()},2e4);$.ajax({url:"/add",method:"POST",data:{url:e,uid:firebase.auth().currentUser.uid},success:function(a,e,r){$("#addModal .modal-body .progress-bar").css("width","100%"),$("#addModal .modal-body .progress").remove(),$("#addModal .modal-body .prepend").remove(),a.success?(resetModal("#addModal"),alertSend("You have "+a.remaining+" tracks remaining.","#addModal .modal-body","success","Product saved!"),$("#addproduct").closest(".form-group").addClass("has-success"),setTimeout(function(){location.reload()},2e3)):(alertSend(a.error.message,"#addModal .modal-body","danger","Error!"),console.log(a.error)),clearTimeout(o),hideLoading()},error:function(a,e,r){alertSend("Error while processing request. Please, check again later.","#addModal .modal-body","danger",r),console.log(r),clearTimeout(o),hideLoading()}})}else alertSend("Empty URL. Please, check.","#addModal .modal-body"),$("#addproduct").closest(".form-group").addClass("has-error")}),$("#addModal").on("hidden.bs.modal",function(a){resetModal("#addModal")}),$(".signoutBtn").on("click",function(a){ga("send","event","click","btn","SignOut"),loading(),setTimeout(function(){hideLoading()},5e3),signOut()}),hideLoading()});